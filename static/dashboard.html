<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
</head>
<body>
  <h2>Your Dashboard</h2><hr>
  <h3>Create Article</h3>
  <form id="create-article">
    <input name="title" placeholder="Title"><br><br>
    <textarea name="content" placeholder="Content" required></textarea><br><br>
    <input name="author_name" placeholder="author_name"><br><br>
    <button type="submit" >Create Article</button>
  </form><hr>
  <p id="msg"></p>
  <button id="list-btn">List All Articles</button>
  <h3>Articles</h3>
  <div id="articles-list"></div>



  <script>//js script starts here
  //create article
const form = document.getElementById("create-article");
const msg = document.getElementById("msg");

form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const data = {
        title: form.title.value,
        content: form.content.value,
        author_name:form.author_name.value
    };

    const res = await fetch("/api/articles", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    });
       let body;
    try {
        body = await res.json();
    } catch {
        msg.textContent = "Server returned invalid response";
        return;
    }

    if (res.ok) {
        msg.textContent = "Article created successfully!";
        form.reset();
    } else {
        msg.textContent = body.detail || "Failed to create article";
    }
  

    
});




//load articles
async function loadArticles() {
    const list = document.getElementById("articles-list");

    const res = await fetch("/api/articles",{method :'GET'});
    const data = await res.json();

    list.innerHTML = "";  // clear before rendering

    if (!res.ok) {
        list.textContent = "Failed to load articles";
        return;
    }

    // loop through articles and show them
    data.forEach(article => {
        const div = document.createElement("div");
        div.style.border = "1px solid #ccc";
        div.style.padding = "10px";
        div.style.marginBottom = "10px";
        
        div.innerHTML = `
            <h4>${article.title}</h4>
            <p>${article.content}</p>
            <small>Author: ${article.author_name}</small>`;

        list.appendChild(div);
    });
}
document.getElementById("list-btn").addEventListener("click", () => {
    loadArticles();

    form.reset();
});


</script>


</body>
</html>
